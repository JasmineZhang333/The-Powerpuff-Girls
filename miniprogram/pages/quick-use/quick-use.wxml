<view class="container">
  <view class="header">
    <text class="header-title">ğŸ¿ ä¸€é”®ä¸Šå¢™</text>
    <text class="header-desc">é€‰æ‹©å²©é¦†,å¿«é€Ÿåˆ·å¡!</text>
  </view>

  <view class="current-user" bindtap="changeUser">
    <text class="user-label">å½“å‰ç”¨æˆ·:</text>
    <text class="user-name">{{currentUser.name}}</text>
    <text class="user-arrow">åˆ‡æ¢ â–¼</text>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">é€‰æ‹©å²©é¦†</text>
      <text class="section-count">{{gymList.length}}ä¸ªå²©é¦†</text>
    </view>

    <picker mode="selector" 
            range="{{gymList}}" 
            bindchange="onGymChange">
      <view class="gym-picker">
        <text class="picker-label">å½“å‰å²©é¦†:</text>
        <text class="picker-value">{{selectedGym}}</text>
        <text class="picker-arrow">â–¼</text>
      </view>
    </picker>

    <view class="gym-cards" wx:if="{{selectedGym && groupedCards[selectedGym]}}">
      <view class="cards-header">
        <text class="cards-title">{{selectedGym}}</text>
        <text class="cards-count">{{groupedCards[selectedGym].length}}å¼ å¯ç”¨</text>
      </view>

      <view class="card-list">
        <view class="card-item {{item.remain_times <= 1 ? 'last-one' : ''}}"
              wx:for="{{groupedCards[selectedGym]}}"
              wx:key="_id">
          
          <view class="card-info">
            <view class="card-row">
              <text class="card-owner">{{item.owner_name}}</text>
              <text class="card-phone" wx:if="{{item.phone}}">{{item.phone}}</text>
              <text class="card-price">Â¥{{item.price_per_time}}/æ¬¡</text>
            </view>
            
            <view class="card-row">
              <text class="card-times">å‰©ä½™ <text class="highlight">{{item.remain_times}}</text> æ¬¡</text>
              <text class="card-expiry">{{item.expiry_date_display}}</text>
            </view>
            
            <view class="card-row" wx:if="{{item.shared_with.length > 0}}">
              <text class="shared-info">å…±äº«ç»™: {{item.shared_with.join(', ')}}</text>
            </view>
          </view>

          <view class="card-actions">
            <button class="use-btn {{item.remain_times <= 0 ? 'disabled' : ''}}" 
                    bindtap="useCard" 
                    data-card="{{item}}"
                    disabled="{{item.remain_times <= 0}}">
              {{item.remain_times <= 0 ? 'å·²ç”¨å®Œ' : 'ä½¿ç”¨'}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:if="{{!selectedGym || gymList.length === 0}}">
      <text class="empty-icon">ğŸ½</text>
      <text class="empty-text">æš‚æ— å¯ç”¨çš„æ¬¡å¡</text>
      <text class="empty-tip">è¯·å…ˆæ·»åŠ æ¬¡å¡æˆ–è”ç³»æŒå¡äººåˆ†äº«</text>
    </view>
  </view>

  <view class="quick-actions">
    <view class="action-card" bindtap="showRecentRecords">
      <text class="action-icon">ğŸ“‹</text>
      <text class="action-text">æœ€è¿‘è®°å½•</text>
    </view>
    <view class="action-card" bindtap="scanQRCode">
      <text class="action-icon">ğŸ“±</text>
      <text class="action-text">æ‰«ç ä½¿ç”¨</text>
    </view>
    <view class="action-card" bindtap="addQuickCard">
      <text class="action-icon">â•</text>
      <text class="action-text">å¿«é€ŸåŠ å¡</text>
    </view>
  </view>

  <view class="usage-tips">
    <text class="tips-title">ğŸ’¡ ä½¿ç”¨æç¤º</text>
    <text class="tips-content">é€‰æ‹©å²©é¦†å,ç‚¹å‡»ä¸‹æ–¹æ¬¡å¡çš„"ä½¿ç”¨"æŒ‰é’®,ç³»ç»Ÿå°†è‡ªåŠ¨æ‰£é™¤ä¸€æ¬¡å¹¶è®°å½•æ‚¨çš„ä½¿ç”¨ä¿¡æ¯ã€‚</text>
  </view>

  <view class="gym-tabs" wx:if="{{gymList.length > 1}}">
    <scroll-view class="tabs-scroll" scroll-x="true" enhanced="true" show-scrollbar="false">
      <view class="tabs-list">
        <view class="tab-item {{gym === selectedGym ? 'active' : ''}}"
              wx:for="{{gymList}}"
              wx:for-item="gym"
              wx:key="gym"
              bindtap="switchGym"
              data-gym="{{gym}}">
          <text class="tab-name">{{gym}}</text>
          <text class="tab-count">{{groupedCards[gym].length}}å¼ </text>
        </view>
      </view>
    </scroll-view>
  </view>

  <view class="user-picker-mask" wx:if="{{showUserPicker}}" bindtap="hideUserPicker"></view>
  <view class="user-picker {{showUserPicker ? 'show' : ''}}">
    <view class="picker-header">
      <text class="picker-cancel" bindtap="hideUserPicker">å–æ¶ˆ</text>
      <text class="picker-title">é€‰æ‹©ç”¨æˆ·</text>
      <text class="picker-confirm" bindtap="confirmSelectUser">ç¡®å®š</text>
    </view>
    <scroll-view class="picker-list" scroll-y>
      <view class="picker-item {{item.name === tempUser.name ? 'selected' : ''}}"
            wx:for="{{userOptions}}"
            wx:key="name"
            bindtap="selectTempUser" 
            data-user="{{item}}">
        <text class="picker-name">{{item.name}}</text>
        <text class="picker-role">({{item.role}})</text>
      </view>
    </scroll-view>
  </view>
</view>
